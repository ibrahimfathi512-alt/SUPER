<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <style>
        body { background: #f8fafb; font-family: 'Segoe UI', sans-serif; padding: 25px; margin: 0; }
        .nav { background: white; padding: 15px 30px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 25px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .card { background: white; padding: 20px; border-radius: 15px; border-right: 6px solid #ff5e00; text-align: center; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 15px; overflow: hidden; }
        th { background: #ff5e00; color: white; padding: 15px; }
        td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; }
        .row-alert { background-color: #ffe0e3 !important; }
        .wallet-locked { background-color: #d63031 !important; color: white !important; font-weight: bold; border-radius: 8px; }
        .btn { padding: 10px 15px; border-radius: 10px; text-decoration: none; color: white; font-weight: bold; font-size: 0.9em; }
    </style>
</head>
<body>
    <div class="nav">
        <h2 style="color: #ff5e00;">Ø²ÙˆÙ†: <%= zone %></h2>
        <div style="display: flex; gap: 10px;">
            <a href="/targets" class="btn" style="background: #ff5e00;">ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ§Ø±Ø¬Øª ğŸ“Š</a>
            <a href="/new-riders" class="btn" style="background: #007bff;">Ø§Ù„ØªØ¹ÙŠÙŠÙ†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ğŸ†•</a>
            <a href="/download" class="btn" style="background: #28a745;">ØªØ­Ù…ÙŠÙ„ Excel ğŸ“¥</a>
        </div>
    </div>

    <div class="stats-grid">
        <div class="card"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙˆØ©</h3><h2><%= stats.total %></h2></div>
        <div class="card" style="border-right-color: #28a745;"><h3>Ø­Ø§Ø¬Ø²ÙŠÙ† Ø´ÙŠÙØª</h3><h2><%= stats.withShifts %></h2></div>
        <div class="card" style="border-right-color: #636e72;"><h3>ØºÙŠØ± Ø­Ø§Ø¬Ø²ÙŠÙ†</h3><h2><%= stats.noShifts %></h2></div>
        <div class="card" style="border-right-color: #007bff;"><h3>Ø¬Ø¯Ø¯ (ÙŠÙ†Ø§ÙŠØ±)</h3><h2><%= stats.newCount %></h2></div>
        <div class="card" style="border-right-color: #dc3545;"><h3>Ù…Ø­Ø§ÙØ¸ > 1000</h3><h2><%= stats.highWallet %></h2></div>
    </div>

    <input type="text" id="srch" onkeyup="search()" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ù€ ID Ø£Ùˆ Ø§Ù„Ø§Ø³Ù…..." style="width: 100%; padding: 15px; margin-bottom: 20px; border-radius: 12px; border: 2px solid #ddd; outline: none;">

    <table id="tbl">
        <thead><tr> <% headers.forEach(h => { %> <th><%= h %></th> <% }) %> </tr></thead>
        <tbody>
            <% riders.forEach(r => { 
                let wallet = cleanData(r.get('Ø§Ù„Ù…Ø­ÙØ¸Ù‡'));
                let isAlert = (cleanData(r.get('Ø´ÙŠÙØªØ§Øª Ø§Ù„ØºØ¯')) === 0) || (cleanData(r.get('Ø§Ù„ØªØ§Ø®ÙŠØ±Ø§Øª')) > 0);
            %>
            <tr class="<%= isAlert ? 'row-alert' : '' %>">
                <% headers.forEach(h => { %>
                    <td class="<%= (h === 'Ø§Ù„Ù…Ø­ÙØ¸Ù‡' && wallet > 1000) ? 'wallet-locked' : '' %>">
                        <%= cleanData(r.get(h)) %>
                        <%= (h === 'Ø§Ù„Ù…Ø­ÙØ¸Ù‡' && wallet > 1000) ? 'ğŸ”’' : '' %>
                    </td>
                <% }) %>
            </tr>
            <% }) %>
        </tbody>
    </table>

    <script>
        function search() {
            let f = document.getElementById("srch").value.toLowerCase();
            let rows = document.getElementById("tbl").getElementsByTagName("tr");
            for (let i = 1; i < rows.length; i++) {
                rows[i].style.display = rows[i].innerText.toLowerCase().includes(f) ? "" : "none";
            }
        }
    </script>
</body>
</html>